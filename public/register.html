<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register - Join Us Today</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .input-group {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 15px; /* Adjust as needed */
      top: 50%;
      transform: translateY(-100%);
      cursor: pointer;
      font-size: 1.1rem; 
      color: #888; /* Adjust color */
    }
    
    .floating-label {
      position: absolute;
      left: 12px;
      top: 13px;
      font-size: 16px;
      color: #6b7280;
      transition: all 0.2s ease-in-out;
      pointer-events: none;
      background: transparent;
      padding: 0 4px;
    }
    
    .input-bordered:focus + .floating-label,
    .input-bordered:not(:placeholder-shown) + .floating-label {
      top: -10px;
      font-size: 12px;
      color: #3b82f6;
      background: white;
      padding: 0 4px;
    }
    
    .password-strength {
      height: 4px;
      background: #e5e7eb;
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .password-strength-bar {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }
    
    .strength-weak { background: #ef4444; width: 33%; }
    .strength-medium { background: #f59e0b; width: 66%; }
    .strength-strong { background: #10b981; width: 100%; }
    
    .btn-loading {
      position: relative;
    }
    
    .btn-loading::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      margin: auto;
      border: 2px solid transparent;
      border-top-color: #ffffff;
      border-radius: 50%;
      animation: spin 1s ease infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .alert {
      transform: translateY(-10px);
      opacity: 0;
      animation: slideDown 0.3s ease-out forwards;
    }
    
    @keyframes slideDown {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .input-error {
      border-color: #ef4444 !important;
    }
    
    .input-success {
      border-color: #10b981 !important;
    }
  </style>
</head>
<body class="gradient-bg flex items-center justify-center py-8">

  <div class="card w-full max-w-md mx-4 bg-white shadow-2xl fade-in">
    <div class="card-body p-8">
      <!-- Header -->
      <div class="text-center mb-6">
        <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
        <p class="text-gray-600 mt-1">Join us and get started today</p>
      </div>

      <!-- Error Alert -->
      <div id="errorAlert" class="alert alert-error mb-4 hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span id="errorMessage"></span>
      </div>

      <!-- Success Alert -->
      <div id="successAlert" class="alert alert-success mb-4 hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span id="successMessage"></span>
      </div>

      <form id="registerForm" class="space-y-5">
        <!-- Username Input -->
        <div class="input-group">
          <input 
            type="text" 
            id="username" 
            placeholder=" " 
            class="input input-bordered w-full bg-transparent pt-3 pb-2 text-black" 
            required 
            minlength="3"
            maxlength="20"
          />
          <label class="floating-label">Username</label>
          <div class="text-xs text-gray-500 mt-1">3-20 characters, letters and numbers only</div>
        </div>

        <!-- Email Input -->
        <div class="input-group">
          <input 
            type="email" 
            id="email" 
            placeholder=" " 
            class="input input-bordered w-full bg-transparent pt-3 pb-2 text-black" 
            required 
          />
          <label class="floating-label">Email Address</label>
        </div>

        <!-- Password Input -->
        <div class="input-group">
          <input type="password" 
                 id="passwordInput" 
                 placeholder=" " 
                 class="input input-bordered w-full bg-transparent pt-3 pb-2 text-black" 
                 required 
                 minlength="6"/>
          <label class="floating-label">Password</label>
           <span class="password-toggle z-50" id="passwordToggle">
            <i class="fas fa-eye"></i>
          </span>
          <div class="password-strength">
            <div id="passwordStrengthBar" class="password-strength-bar"></div>
          </div>
          <div id="passwordStrengthText" class="text-xs mt-1 text-gray-500">
            Password strength: <span id="strengthLevel">Enter password</span>
          </div>
        </div>

        <!-- Confirm Password Input -->
        <div class="input-group">
          <input 
            type="password" 
            id="confirmPassword" 
            placeholder=" " 
            class="input input-bordered w-full bg-transparent pt-3 pb-2 text-black" 
            required 
          />
          <label class="floating-label">Confirm Password</label>
          <div id="passwordMatchText" class="text-xs mt-1 hidden"></div>
        </div>

        <button id="registerBtn" class="btn btn-primary w-full h-12 text-base font-medium" type="submit">
          <span id="registerBtnText">Create Account</span>
        </button>
      </form>

      <p class="text-center text-gray-600">
        Already have an account?
        <a href="login.html" class="link link-primary font-medium hover:text-primary-focus">Sign in</a>
      </p>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
    const SUPABASE_URL = "https://kntomoredgduvwbovgpx.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtudG9tb3JlZGdkdXZ3Ym92Z3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2MzI0NzcsImV4cCI6MjA3MDIwODQ3N30.Ei7vJ8RQCiz7KPXis6He8dVzL91Euocxzxzg1ptg1_U";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const registerForm = document.getElementById("registerForm");
    const registerBtn = document.getElementById("registerBtn");
    const registerBtnText = document.getElementById("registerBtnText");
    const errorAlert = document.getElementById("errorAlert");
    const successAlert = document.getElementById("successAlert");

    function showError(message) {
      document.getElementById("errorMessage").textContent = message;
      errorAlert.classList.remove("hidden");
      successAlert.classList.add("hidden");
      setTimeout(() => errorAlert.classList.add("hidden"), 5000);
    }

    function showSuccess(message) {
      document.getElementById("successMessage").textContent = message;
      successAlert.classList.remove("hidden");
      errorAlert.classList.add("hidden");
    }

    function setLoading(loading) {
      if (loading) {
        registerBtn.classList.add("btn-loading", "loading");
        registerBtn.disabled = true;
        registerBtnText.textContent = "Creating Account...";
      } else {
        registerBtn.classList.remove("btn-loading", "loading");
        registerBtn.disabled = false;
        registerBtnText.textContent = "Create Account";
      }
    }

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function validateUsername(username) {
      const usernameRegex = /^[a-zA-Z0-9]{3,20}$/;
      return usernameRegex.test(username);
    }

    function getPasswordStrength(password) {
      let strength = 0;
      if (password.length >= 8) strength += 1;
      if (/[a-z]/.test(password)) strength += 1;
      if (/[A-Z]/.test(password)) strength += 1;
      if (/[0-9]/.test(password)) strength += 1;
      if (/[^A-Za-z0-9]/.test(password)) strength += 1;
      return strength;
    }

    function updatePasswordStrength() {
      const password = document.getElementById("passwordInput").value;
      const strengthBar = document.getElementById("passwordStrengthBar");
      const strengthText = document.getElementById("strengthLevel");
      
      if (password.length === 0) {
        strengthBar.className = "password-strength-bar";
        strengthText.textContent = "Enter password";
        return;
      }
      
      const strength = getPasswordStrength(password);
      
      if (strength <= 2) {
        strengthBar.className = "password-strength-bar strength-weak";
        strengthText.textContent = "Weak";
        strengthText.style.color = "#ef4444";
      } else if (strength <= 3) {
        strengthBar.className = "password-strength-bar strength-medium";
        strengthText.textContent = "Medium";
        strengthText.style.color = "#f59e0b";
      } else {
        strengthBar.className = "password-strength-bar strength-strong";
        strengthText.textContent = "Strong";
        strengthText.style.color = "#10b981";
      }
    }

    function checkPasswordMatch() {
      const password = document.getElementById("passwordInput").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const matchText = document.getElementById("passwordMatchText");
      const confirmInput = document.getElementById("confirmPassword");
      
      if (confirmPassword.length === 0) {
        matchText.classList.add("hidden");
        confirmInput.classList.remove("input-error", "input-success");
        return;
      }
      
      if (password === confirmPassword) {
        matchText.textContent = "Passwords match âœ“";
        matchText.style.color = "#10b981";
        matchText.classList.remove("hidden");
        confirmInput.classList.remove("input-error");
        confirmInput.classList.add("input-success");
      } else {
        matchText.textContent = "Passwords don't match";
        matchText.style.color = "#ef4444";
        matchText.classList.remove("hidden");
        confirmInput.classList.remove("input-success");
        confirmInput.classList.add("input-error");
      }
    }
    // Event listener for toggle password
    document.addEventListener('DOMContentLoaded', function() {
      const passwordInput = document.getElementById('passwordInput');
      const passwordToggle = document.getElementById('passwordToggle');

      passwordToggle.addEventListener('click', function() {
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          this.innerHTML = '<i class="fas fa-eye-slash"></i>';  // Change to closed eye icon
        } else {
          passwordInput.type = 'password';
          this.innerHTML = '<i class="fas fa-eye"></i>';        // Change back to open eye icon
        }
      });
    });

    // Event listeners for real-time validation
    document.getElementById("username").addEventListener("input", (e) => {
      const username = e.target.value;
      const input = e.target;
      
      if (username.length === 0) {
        input.classList.remove("input-error", "input-success");
        return;
      }
      
      if (validateUsername(username)) {
        input.classList.remove("input-error");
        input.classList.add("input-success");
      } else {
        input.classList.remove("input-success");
        input.classList.add("input-error");
      }
    });

    document.getElementById("email").addEventListener("input", (e) => {
      const email = e.target.value;
      const input = e.target;
      
      if (email.length === 0) {
        input.classList.remove("input-error", "input-success");
        return;
      }
      
      if (validateEmail(email)) {
        input.classList.remove("input-error");
        input.classList.add("input-success");
      } else {
        input.classList.remove("input-success");
        input.classList.add("input-error");
      }
    });

    document.getElementById("passwordInput").addEventListener("input", () => {
      updatePasswordStrength();
      checkPasswordMatch();
    });

    document.getElementById("confirmPassword").addEventListener("input", checkPasswordMatch);

    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("passwordInput").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const agreeTerms = document.getElementById("agreeTerms").checked;

      // Client-side validation
      if (!validateUsername(username)) {
        showError("Username must be 3-20 characters, letters and numbers only");
        return;
      }

      if (!validateEmail(email)) {
        showError("Please enter a valid email address");
        return;
      }

      if (password.length < 6) {
        showError("Password must be at least 6 characters long");
        return;
      }

      if (password !== confirmPassword) {
        showError("Passwords do not match");
        return;
      }

      if (!agreeTerms) {
        showError("Please agree to the Terms of Service and Privacy Policy");
        return;
      }

      setLoading(true);

      try {
        // Check if username already exists
        const { data: existingUser, error: checkError } = await supabase
          .from("profiles")
          .select("username")
          .eq("username", username)
          .single();

        if (existingUser) {
          showError("Username already taken. Please choose another one.");
          setLoading(false);
          return;
        }

        // Register user
        const { data, error } = await supabase.auth.signUp({ 
          email, 
          password,
          options: {
            data: {
              username: username
            }
          }
        });
        
        if (error) {
          throw error;
        }

        // Insert user profile
        const { error: insertError } = await supabase
          .from("profiles")
          .insert([{ 
            id: data.user.id, 
            username, 
            email, 
            role: "user",
            created_at: new Date().toISOString()
          }]);

        if (insertError) {
          console.warn("Profile creation error:", insertError.message);
          // Don't show error to user as auth was successful
        }

        showSuccess("Registration successful! Please check your email to verify your account.");
        
        setTimeout(() => {
          window.location.href = "login.html";
        }, 2000);

      } catch (error) {
        console.error("Registration error:", error);
        let errorMessage = "An error occurred during registration";
        
        if (error.message.includes("User already registered")) {
          errorMessage = "An account with this email already exists";
        } else if (error.message.includes("Password should be at least 6 characters")) {
          errorMessage = "Password must be at least 6 characters long";
        } else if (error.message) {
          errorMessage = error.message;
        }
        
        showError(errorMessage);
      } finally {
        setLoading(false);
      }
    });

    // Auto-hide alerts when user starts typing
    document.querySelectorAll("input").forEach(input => {
      input.addEventListener("input", () => {
        errorAlert.classList.add("hidden");
        successAlert.classList.add("hidden");
      });
    });

    // Check if user is already logged in
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN' && session) {
        window.location.href = "login.html";
      }
    });
  </script>
</body>
</html>